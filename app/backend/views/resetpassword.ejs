<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/styles/resetpassword.css">
  <title>Document</title>
</head>

<body>
  <div class="mainDiv">
    <div class="cardStyle">
      <form action="/user/resetpassword" method="post" name="resetPasswordForm" id="resetPasswordForm">
        <h2 class="formTitle">Change Password</h2>
        <div class="inputDiv">
          <label class="inputLabel" for="email">Email</label>
          <input type="email" id="email" name="email" required placeholder="Enter your Email ID">
        </div>
        <div class="inputDiv">
          <label class="inputLabel" for="password">New Password</label>
          <input type="password" id="password" name="newP" required placeholder="Enter new Password">
        </div>
        <div class="inputDiv">
          <label class="inputLabel" for="confirmPassword">Confirm Password</label>
          <input type="password" id="confirmPassword" name="confP" placeholder="Confirm Password">
        </div>
        <div class="buttonWrapper">
          <button type="button" id="submitButton" onclick="handleSubmit" class="submitButton pure-button pure-button-primary">
            <span>Confirm</span>
            <span id="loader"></span>
          </button>
        </div>
      </form>
    </div>
  </div>

  <script>
    var password = document.getElementById("password"),
      confirm_password = document.getElementById("confirmPassword");

    const submit = document.getElementById("submitButton");

    submit.addEventListener("click", handleSubmit);

    function handleSubmit() {
      if (validatePassword()) {
        fetch('/user/resetpassword', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            email: document.getElementById('email').value,
            newP: document.getElementById('password').value,
            confP: document.getElementById('confirmPassword').value
          })
        })
          .then(response => response.json())
          .then(data => {
            // Handle the response as needed
            alert('Password reset successful');
            window.location.href = '/user/logout'; // Redirect to /user/logout after successful password reset
          })
          .catch(error => {
            console.error('Error resetting password:', error);
          });
      } else {
        // Handle the case where the password is not valid
      }
    }

    function validatePassword() {
      let isValid = 1;

      var lengthRegex = /.{8,}/; // At least 8 characters

      if (password.value != confirm_password.value) {
        password.setCustomValidity('Passwords do not match');
        alert('Passwords do not match');
        return false;
      }
      isValid = lengthRegex.test(password.value);
      if (!isValid) {
        password.setCustomValidity('Password must be at least 8 characters long');
        alert('Password must be at least 8 characters long');
        return false;
      }
      var anyCharacterRegex = /[a-zA-Z]/;
      isValid = anyCharacterRegex.test(password.value);
      if (!isValid) {
        password.setCustomValidity('Password must contain at least one character');
        alert('Password must contain at least one character');
        return false;
      }

      var digitRegex = /\d/; // At least one digit
      isValid = digitRegex.test(password.value);
      if (!isValid) {
        password.setCustomValidity('Password must contain at least one digit');
        alert('Password must contain at least one digit');
        return false;
      }

      return true;
    }
  </script>
</body>

</html>
